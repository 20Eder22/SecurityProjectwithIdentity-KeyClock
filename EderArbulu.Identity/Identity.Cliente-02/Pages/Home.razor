@page "/"
@using Microsoft.AspNetCore.Authorization
@using Services
@attribute [Authorize]
@inject AuthenticationStateProvider Auth
@inject NavigationManager Navegador
@inject IToastService ToastService

<PageTitle>Inicio</PageTitle>

<nav class="navbar">
    <div class="navbar-brand">
        <i class="bi bi-gear-wide-connected"></i>
        <span>Sistema de Configuraciones</span>
    </div>

    <div class="navbar-links">
        @foreach (var action in _availableActions)
        {
            <a @onclick="@(() => Navegador.NavigateTo(action.Url))">
                <i class="@action.Icon"></i> @action.Label
            </a>
        }

        <a class="logout" @onclick="CerrarSesion">
            <i class="bi bi-door-open"></i> Cerrar Sesión
        </a>
    </div>
</nav>

<div class="home-content">
    <h1>Bienvenido al Sistema de Configuraciones</h1>
    <p>Acá podrás realizar todas las configuraciones de todos los microservicios.</p>
</div>

@code {
    private readonly List<MenuAction> _availableActions = [];

    protected override async Task OnInitializedAsync()
    {
        var authState = await Auth.GetAuthenticationStateAsync();
        var user = authState.User;

        _availableActions.Add(new MenuAction("Ver accesos", "/accesos", "bi bi-clipboard2-pulse-fill"));
        _availableActions.Add(new MenuAction("Test Auth", "/test-auth", "bi bi-clipboard2-pulse-fill"));
    }

    public async Task CerrarSesion()
    {
        try
        {
            if (Auth is CustomAuthStateProvider authService)
            {
                await authService.LogoutAsync();
                Navegador.NavigateTo("/login", true);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al cerrar sesión: {ex.Message}");
            ToastService.ShowError("Ocurrió un error inesperado al cerrar sesión.");
        }
    }

    private record MenuAction(string Label, string Url, string Icon);
}

<style>
    /* ======== RESETEO GENERAL ======== */
    body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #007bff, #00c6ff);
        color: #222;
        min-height: 100vh;
    }

    /* ======== NAVBAR ======== */
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 70px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        padding: 0 40px;
        z-index: 100;
    }

    /* ======== LOGO / BRAND ======== */
    .navbar-brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 20px;
        font-weight: 600;
        color: #0d47a1;
    }

        .navbar-brand i {
            font-size: 24px;
            color: #1565c0;
        }

    /* ======== LINKS ======== */
    .navbar-links {
        display: flex;
        align-items: center;
        gap: 30px;
    }

        .navbar-links a {
            text-decoration: none;
            color: #222;
            font-weight: 500;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease, transform 0.2s ease;
            cursor: pointer;
        }

            .navbar-links a i {
                font-size: 18px;
                color: #1976d2;
            }

            .navbar-links a:hover {
                color: #0d47a1;
                transform: translateY(-2px);
            }

            /* ======== LOGOUT DIFERENCIADO ======== */
            .navbar-links a.logout {
                color: #d32f2f;
            }

                .navbar-links a.logout i {
                    color: #d32f2f;
                }

                .navbar-links a.logout:hover {
                    color: #b71c1c;
                }

    /* ======== CONTENIDO PRINCIPAL ======== */
    .home-content {
        margin-top: 120px;
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        padding: 60px 30px;
        border-radius: 20px;
        width: 80%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

        .home-content h1 {
            font-size: 28px;
            font-weight: 700;
            color: #0d47a1;
            margin-bottom: 15px;
        }

        .home-content p {
            font-size: 17px;
            color: #333;
        }

</style>